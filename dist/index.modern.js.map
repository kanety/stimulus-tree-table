{"version":3,"file":"index.modern.js","sources":["../src/store.js","../src/index.js"],"sourcesContent":["export default class Store {\r\n  constructor(controller) {\r\n    this.controller = controller;\r\n  }\r\n\r\n  get key() {\r\n    return this.controller.storeKeyValue;\r\n  }\r\n\r\n  get nodes() {\r\n    return this.controller.nodes;\r\n  }\r\n\r\n  get openedNodes() {\r\n    return this.controller.openedNodes;\r\n  }\r\n\r\n  load() {\r\n    if (!this.key) return;\r\n\r\n    let ids = this.constructor.load(this.key);\r\n    if (!ids) return;\r\n\r\n    let idSet = new Set(ids);\r\n    this.nodes.reverse().forEach(node => {\r\n      if (idSet.has(node.getAttribute('data-node-id'))) {\r\n        this.controller.show(node)\r\n      } else {\r\n        this.controller.hide(node);\r\n      }\r\n    });\r\n  }\r\n\r\n  save() {\r\n    if (!this.key) return;\r\n\r\n    let ids = this.openedNodes.map(node => node.getAttribute('data-node-id'));\r\n    this.constructor.save(this.key, ids);\r\n  }\r\n\r\n  static load(key) {\r\n    let json = sessionStorage.getItem(key);\r\n    try {\r\n      return JSON.parse(json)\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static save(key, value) {\r\n    sessionStorage.setItem(key, JSON.stringify(value));\r\n  }\r\n}\r\n","import { Controller } from '@hotwired/stimulus';\nimport '@kanety/stimulus-static-actions';\nimport Store from './store';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    storeKey: String\n  };\n  static actions = [\n    ['element', 'click->toggle'],\n    ['element', ':expand->expand'],\n    ['element', ':collapse->collapse']\n  ];\n\n  get nodes() {\n    return this.scope.findAllElements('tr[data-node-id]');\n  }\n\n  get openedNodes() {\n    return this.scope.findAllElements('tr[data-node-id]:not(.st-tree-table__node--closed)');\n  }\n\n  connect() {\n    this.init();\n    this.store = new Store(this);\n    this.store.load();\n  }\n\n  init() {\n    this.nodes.forEach(node => {\n      if (!this.hasChildren(node)) {\n        node.classList.add('st-tree-table__node--leaf', 'st-tree-table__node--closed')\n      }\n    });\n  }\n\n  toggle(e) {\n    if (!e.target.matches('a[href=\"#icon\"]')) return;\n\n    let node = e.target.closest('tr');\n    if (!node.matches('.st-tree-table__node--closed')) {\n      this.close(node);\n    } else {\n      this.open(node);\n    }\n\n    e.preventDefault();\n  }\n\n  expand(e) {\n    this.nodes.forEach(node => this.show(node));\n    this.store.save();\n  }\n\n  collapse(e) {\n    this.nodes.forEach(node => this.hide(node));\n    this.store.save();\n  }\n\n  open(node) {\n    this.show(node);\n    this.store.save();\n\n    this.dispatch('opened', { detail: { node: node } });\n  }\n\n  show(node) {\n    node.classList.remove('st-tree-table__node--closed')\n    this.showDescs(node);\n  }\n\n  showDescs(node) {\n    let children = this.children(node);\n    children.forEach(child => {\n      child.classList.remove('st-tree-table__node--hidden');\n      if (!child.matches('.st-tree-table__node--closed')) {\n        this.showDescs(child);\n      }\n    });\n  }\n\n  close(node) {\n    this.hide(node);\n    this.store.save();\n\n    this.dispatch('closed', { detail: { node: node } });\n  }\n\n  hide(node) {\n    node.classList.add('st-tree-table__node--closed');\n    this.hideDescs(node);\n  }\n\n  hideDescs(node) {\n    let children = this.children(node);\n    children.forEach(child => {\n      child.classList.add('st-tree-table__node--hidden');\n      this.hideDescs(child);\n    });\n  }\n\n  hasChildren(node) {\n    return this.children(node).length != 0;\n  }\n\n  children(node) {\n    let id = node.getAttribute('data-node-id');\n    return this.scope.findAllElements(`tr[data-node-pid=\"${id}\"]`);\n  }\n}\n"],"names":["Store","constructor","controller","this","key","storeKeyValue","nodes","openedNodes","load","ids","idSet","Set","reverse","forEach","node","has","getAttribute","show","hide","save","map","static","json","sessionStorage","getItem","JSON","parse","value","setItem","stringify","Controller","scope","findAllElements","connect","init","store","hasChildren","classList","add","toggle","e","target","matches","closest","open","close","preventDefault","expand","collapse","dispatch","detail","remove","showDescs","children","child","hideDescs","length","id","values","storeKey","String","actions"],"mappings":"8FAAqBA,EACnBC,YAAYC,GACVC,KAAKD,WAAaA,EAGhBE,UACF,YAAYF,WAAWG,cAGrBC,YACF,YAAYJ,WAAWI,MAGrBC,kBACF,YAAYL,WAAWK,YAGzBC,OACE,IAAKL,KAAKC,IAAK,OAEf,IAAIK,EAAMN,KAAKF,YAAYO,KAAKL,KAAKC,KACrC,IAAKK,EAAK,OAEV,IAAIC,EAAQ,IAAIC,IAAIF,GACpBN,KAAKG,MAAMM,UAAUC,QAAQC,IACvBJ,EAAMK,IAAID,EAAKE,aAAa,iBAC9Bb,KAAKD,WAAWe,KAAKH,GAErBX,KAAKD,WAAWgB,KAAKJ,KAK3BK,OACE,IAAKhB,KAAKC,IAAK,OAEf,IAAIK,EAAMN,KAAKI,YAAYa,IAAIN,GAAQA,EAAKE,aAAa,iBACzDb,KAAKF,YAAYkB,KAAKhB,KAAKC,IAAKK,GAGvBY,YAACjB,GACV,IAAIkB,EAAOC,eAAeC,QAAQpB,GAClC,IACE,OAAOqB,KAAKC,MAAMJ,GAClB,SACA,aAIOD,YAACjB,EAAKuB,GACfJ,eAAeK,QAAQxB,EAAKqB,KAAKI,UAAUF,qBC7ClBG,EAUvBxB,YACF,YAAYyB,MAAMC,gBAAgB,oBAGhCzB,kBACF,YAAYwB,MAAMC,gBAAgB,sDAGpCC,UACE9B,KAAK+B,OACL/B,KAAKgC,MAAQ,IAAInC,EAAMG,MACvBA,KAAKgC,MAAM3B,OAGb0B,OACE/B,KAAKG,MAAMO,QAAQC,IACZX,KAAKiC,YAAYtB,IACpBA,EAAKuB,UAAUC,IAAI,4BAA6B,iCAKtDC,OAAOC,GACL,IAAKA,EAAEC,OAAOC,QAAQ,mBAAoB,OAE1C,IAAI5B,EAAO0B,EAAEC,OAAOE,QAAQ,MACvB7B,EAAK4B,QAAQ,gCAGhBvC,KAAKyC,KAAK9B,GAFVX,KAAK0C,MAAM/B,GAKb0B,EAAEM,iBAGJC,OAAOP,GACLrC,KAAKG,MAAMO,QAAQC,GAAQX,KAAKc,KAAKH,IACrCX,KAAKgC,MAAMhB,OAGb6B,SAASR,GACPrC,KAAKG,MAAMO,QAAQC,GAAQX,KAAKe,KAAKJ,IACrCX,KAAKgC,MAAMhB,OAGbyB,KAAK9B,GACHX,KAAKc,KAAKH,GACVX,KAAKgC,MAAMhB,OAEXhB,KAAK8C,SAAS,SAAU,CAAEC,OAAQ,CAAEpC,KAAMA,KAG5CG,KAAKH,GACHA,EAAKuB,UAAUc,OAAO,+BACtBhD,KAAKiD,UAAUtC,GAGjBsC,UAAUtC,GACOX,KAAKkD,SAASvC,GACpBD,QAAQyC,IACfA,EAAMjB,UAAUc,OAAO,+BAClBG,EAAMZ,QAAQ,iCACjBvC,KAAKiD,UAAUE,KAKrBT,MAAM/B,GACJX,KAAKe,KAAKJ,GACVX,KAAKgC,MAAMhB,OAEXhB,KAAK8C,SAAS,SAAU,CAAEC,OAAQ,CAAEpC,KAAMA,KAG5CI,KAAKJ,GACHA,EAAKuB,UAAUC,IAAI,+BACnBnC,KAAKoD,UAAUzC,GAGjByC,UAAUzC,GACOX,KAAKkD,SAASvC,GACpBD,QAAQyC,IACfA,EAAMjB,UAAUC,IAAI,+BACpBnC,KAAKoD,UAAUD,KAInBlB,YAAYtB,GACV,OAAqC,QAAzBuC,SAASvC,GAAM0C,OAG7BH,SAASvC,GACP,IAAI2C,EAAK3C,EAAKE,aAAa,gBAC3B,YAAYe,MAAMC,gBAAiB,qBAAoByB,UAtGlDC,OAAS,CACdC,SAAUC,UAELC,QAAU,CACf,CAAC,UAAW,iBACZ,CAAC,UAAW,mBACZ,CAAC,UAAW"}
{"version":3,"file":"index.js","sources":["../src/store.js","../src/index.js"],"sourcesContent":["export default class Store {\n  constructor(controller) {\n    this.controller = controller;\n  }\n\n  get key() {\n    return this.controller.storeKeyValue;\n  }\n\n  get nodes() {\n    return this.controller.nodes;\n  }\n\n  get openedNodes() {\n    return this.controller.openedNodes;\n  }\n\n  load() {\n    if (!this.key) return;\n\n    let ids = this.constructor.load(this.key);\n    if (!ids) return;\n\n    let idSet = new Set(ids);\n    this.nodes.reverse().forEach(node => {\n      if (idSet.has(node.getAttribute('data-node-id'))) {\n        this.controller.show(node)\n      } else {\n        this.controller.hide(node);\n      }\n    });\n  }\n\n  save() {\n    if (!this.key) return;\n\n    let ids = this.openedNodes.map(node => node.getAttribute('data-node-id'));\n    this.constructor.save(this.key, ids);\n  }\n\n  static load(key) {\n    let json = sessionStorage.getItem(key);\n    try {\n      return JSON.parse(json)\n    } catch {\n      return null;\n    }\n  }\n\n  static save(key, value) {\n    sessionStorage.setItem(key, JSON.stringify(value));\n  }\n}\n","import { Controller } from '@hotwired/stimulus';\nimport '@kanety/stimulus-static-actions';\nimport Store from './store';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    marginLeft: { type: Number, default: 20 },\n    storeKey: String\n  };\n  static actions = [\n    ['element', 'click->toggle'],\n    ['element', ':expand->expand'],\n    ['element', ':collapse->collapse']\n  ];\n\n  get nodes() {\n    return this.scope.findAllElements('tr[data-node-id]');\n  }\n\n  get openedNodes() {\n    return this.scope.findAllElements('tr[data-node-id]:not(.st-tree-table__node--closed)');\n  }\n\n  connect() {\n    this.init();\n    this.store = new Store(this);\n    this.store.load();\n  }\n\n  init() {\n    this.nodes.forEach(node => {\n      let icon = node.querySelector('a[href=\"#icon\"]');\n      if (icon && !icon.style.marginLeft && this.marginLeftValue) {\n        icon.style.marginLeft = (this.depth(node) - 1) * this.marginLeftValue + 'px';\n      }\n      if (!this.hasChildren(node)) {\n        node.classList.add('st-tree-table__node--leaf', 'st-tree-table__node--closed')\n      }\n      if (node.matches('.st-tree-table__node--closed')) {\n        this.hide(node);\n      }\n    });\n  }\n\n  toggle(e) {\n    if (!e.target.matches('a[href=\"#icon\"]')) return;\n\n    let node = e.target.closest('tr');\n    if (!node.matches('.st-tree-table__node--closed')) {\n      this.close(node);\n    } else {\n      this.open(node);\n    }\n\n    e.preventDefault();\n  }\n\n  expand(e) {\n    this.nodes.forEach(node => this.show(node));\n    this.store.save();\n  }\n\n  collapse(e) {\n    this.nodes.forEach(node => this.hide(node));\n    this.store.save();\n  }\n\n  open(node) {\n    this.show(node);\n    this.store.save();\n\n    this.dispatch('opened', { detail: { node: node } });\n  }\n\n  show(node) {\n    node.classList.remove('st-tree-table__node--closed')\n    this.showDescs(node);\n  }\n\n  showDescs(node) {\n    let children = this.children(node);\n    children.forEach(child => {\n      child.classList.remove('st-tree-table__node--hidden');\n      if (!child.matches('.st-tree-table__node--closed')) {\n        this.showDescs(child);\n      }\n    });\n  }\n\n  close(node) {\n    this.hide(node);\n    this.store.save();\n\n    this.dispatch('closed', { detail: { node: node } });\n  }\n\n  hide(node) {\n    node.classList.add('st-tree-table__node--closed');\n    this.hideDescs(node);\n  }\n\n  hideDescs(node) {\n    let children = this.children(node);\n    children.forEach(child => {\n      child.classList.add('st-tree-table__node--hidden');\n      this.hideDescs(child);\n    });\n  }\n\n  parent(node) {\n    let pid = node.getAttribute('data-node-pid');\n    return this.scope.findElement(`tr[data-node-id=\"${pid}\"]`);\n  }\n\n  children(node) {\n    let id = node.getAttribute('data-node-id');\n    return this.scope.findAllElements(`tr[data-node-pid=\"${id}\"]`);\n  }\n\n  hasChildren(node) {\n    return this.children(node).length != 0;\n  }\n\n  depth(node) {\n    let parent = this.parent(node);\n    if (parent) {\n      return this.depth(parent) + 1;\n    } else {\n      return 1;\n    }\n  }\n}\n"],"names":["Store","constructor","controller","this","key","storeKeyValue","nodes","openedNodes","load","ids","idSet","Set","reverse","forEach","node","has","getAttribute","show","hide","save","map","static","json","sessionStorage","getItem","JSON","parse","value","setItem","stringify","Controller","scope","findAllElements","connect","init","store","icon","querySelector","style","marginLeft","marginLeftValue","depth","hasChildren","classList","add","matches","toggle","e","target","closest","open","close","preventDefault","expand","collapse","dispatch","detail","remove","showDescs","children","child","hideDescs","parent","pid","findElement","id","length","values","type","Number","default","storeKey","String","actions"],"mappings":"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"}
{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import { Controller } from '@hotwired/stimulus';\nimport '@kanety/stimulus-static-actions';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    storeKey: String\n  };\n  static actions = [\n    ['element', 'click->toggle'],\n    ['element', 'tree-table:expand->expand'],\n    ['element', 'tree-table:collapse->collapse']\n  ];\n\n  get nodes() {\n    return Array.from(this.element.querySelectorAll('tr[data-node-id]'));\n  }\n\n  get openedNodes() {\n    return Array.from(this.element.querySelectorAll('tr[data-node-id]:not(.st-tree-table__node--closed)'));\n  }\n\n  connect() {\n    this.init();\n    this.load();\n  }\n\n  init() {\n    this.nodes.forEach(node => {\n      if (!this.hasChildren(node)) {\n        node.classList.add('st-tree-table__node--leaf', 'st-tree-table__node--closed')\n      }\n    });\n  }\n\n  load() {\n    let ids = this.loadStates();\n    if (!ids) return;\n\n    let idSet = new Set(ids);\n    this.nodes.reverse().forEach(node => {\n      if (idSet.has(node.getAttribute('data-node-id'))) {\n        this.show(node)\n      } else {\n        this.hide(node);\n      }\n    });\n  }\n\n  toggle(e) {\n    if (!e.target.matches('a[href=\"#icon\"]')) return;\n\n    let node = e.target.closest('tr');\n    if (!node.matches('.st-tree-table__node--closed')) {\n      this.close(node);\n    } else {\n      this.open(node);\n    }\n\n    e.preventDefault();\n  }\n\n  expand(e) {\n    this.nodes.forEach(node => this.show(node));\n    this.saveStates();\n  }\n\n  collapse(e) {\n    this.nodes.forEach(node => this.hide(node));\n    this.saveStates();\n  }\n\n  open(node) {\n    this.show(node);\n    this.saveStates();\n\n    this.dispatch('opened', { detail: { node: node } });\n  }\n\n  show(node) {\n    node.classList.remove('st-tree-table__node--closed')\n    this.showDescs(node);\n  }\n\n  showDescs(node) {\n    let children = this.children(node);\n    children.forEach(child => {\n      child.classList.remove('st-tree-table__node--hidden');\n      if (!child.matches('.st-tree-table__node--closed')) {\n        this.showDescs(child);\n      }\n    });\n  }\n\n  close(node) {\n    this.hide(node);\n    this.saveStates();\n\n    this.dispatch('closed', { detail: { node: node } });\n  }\n\n  hide(node) {\n    node.classList.add('st-tree-table__node--closed');\n    this.hideDescs(node);\n  }\n\n  hideDescs(node) {\n    let children = this.children(node);\n    children.forEach(child => {\n      child.classList.add('st-tree-table__node--hidden');\n      this.hideDescs(child);\n    });\n  }\n\n  hasChildren(node) {\n    return this.children(node).length != 0;\n  }\n\n  children(node) {\n    let id = node.getAttribute('data-node-id');\n    return Array.from(this.element.querySelectorAll(`tr[data-node-pid=\"${id}\"]`));\n  }\n\n  loadStates() {\n    if (!this.storeKeyValue) return;\n\n    let json = sessionStorage.getItem(this.storeKeyValue);\n    return json ? JSON.parse(json) : null;\n  }\n\n  saveStates() {\n    if (!this.storeKeyValue) return;\n\n    let ids = this.openedNodes.map(node => node.getAttribute('data-node-id'));\n    sessionStorage.setItem(this.storeKeyValue, JSON.stringify(ids));\n  }\n}\n"],"names":["Controller","nodes","Array","from","this","element","querySelectorAll","openedNodes","connect","init","load","forEach","node","hasChildren","classList","add","ids","loadStates","idSet","Set","reverse","has","getAttribute","show","hide","toggle","e","target","matches","closest","open","close","preventDefault","expand","saveStates","collapse","dispatch","detail","remove","showDescs","children","child","hideDescs","length","id","storeKeyValue","json","sessionStorage","getItem","JSON","parse","map","setItem","stringify","values","storeKey","String","actions"],"mappings":"+FAI6BA,aAUvBC,YACF,OAAOC,MAAMC,KAAKC,KAAKC,QAAQC,iBAAiB,qBAG9CC,kBACF,OAAOL,MAAMC,KAAKC,KAAKC,QAAQC,iBAAiB,uDAGlDE,UACEJ,KAAKK,OACLL,KAAKM,OAGPD,OACEL,KAAKH,MAAMU,QAAQC,IACZR,KAAKS,YAAYD,IACpBA,EAAKE,UAAUC,IAAI,4BAA6B,iCAKtDL,OACE,IAAIM,EAAMZ,KAAKa,aACf,GAAKD,EAAL,CAEA,IAAIE,EAAQ,IAAIC,IAAIH,GACpBZ,KAAKH,MAAMmB,UAAUT,QAAQC,IACvBM,EAAMG,IAAIT,EAAKU,aAAa,iBAC9BlB,KAAKmB,KAAKX,GAEVR,KAAKoB,KAAKZ,MAKhBa,OAAOC,GACL,GAAKA,EAAEC,OAAOC,QAAQ,mBAAtB,CAEA,IAAIhB,EAAOc,EAAEC,OAAOE,QAAQ,MACvBjB,EAAKgB,QAAQ,gCAGhBxB,KAAK0B,KAAKlB,GAFVR,KAAK2B,MAAMnB,GAKbc,EAAEM,kBAGJC,OAAOP,GACLtB,KAAKH,MAAMU,QAAQC,GAAQR,KAAKmB,KAAKX,IACrCR,KAAK8B,aAGPC,SAAST,GACPtB,KAAKH,MAAMU,QAAQC,GAAQR,KAAKoB,KAAKZ,IACrCR,KAAK8B,aAGPJ,KAAKlB,GACHR,KAAKmB,KAAKX,GACVR,KAAK8B,aAEL9B,KAAKgC,SAAS,SAAU,CAAEC,OAAQ,CAAEzB,KAAMA,KAG5CW,KAAKX,GACHA,EAAKE,UAAUwB,OAAO,+BACtBlC,KAAKmC,UAAU3B,GAGjB2B,UAAU3B,GACOR,KAAKoC,SAAS5B,GACpBD,QAAQ8B,IACfA,EAAM3B,UAAUwB,OAAO,+BAClBG,EAAMb,QAAQ,iCACjBxB,KAAKmC,UAAUE,KAKrBV,MAAMnB,GACJR,KAAKoB,KAAKZ,GACVR,KAAK8B,aAEL9B,KAAKgC,SAAS,SAAU,CAAEC,OAAQ,CAAEzB,KAAMA,KAG5CY,KAAKZ,GACHA,EAAKE,UAAUC,IAAI,+BACnBX,KAAKsC,UAAU9B,GAGjB8B,UAAU9B,GACOR,KAAKoC,SAAS5B,GACpBD,QAAQ8B,IACfA,EAAM3B,UAAUC,IAAI,+BACpBX,KAAKsC,UAAUD,KAInB5B,YAAYD,GACV,OAAqC,QAAzB4B,SAAS5B,GAAM+B,OAG7BH,SAAS5B,GACP,IAAIgC,EAAKhC,EAAKU,aAAa,gBAC3B,OAAOpB,MAAMC,KAAKC,KAAKC,QAAQC,sCAAsCsC,SAGvE3B,aACE,GAAKb,KAAKyC,cAAV,CAEA,IAAIC,EAAOC,eAAeC,QAAQ5C,KAAKyC,eACvC,OAAOC,EAAOG,KAAKC,MAAMJ,GAAQ,MAGnCZ,aACE,GAAK9B,KAAKyC,cAAV,CAEA,IAAI7B,EAAMZ,KAAKG,YAAY4C,IAAIvC,GAAQA,EAAKU,aAAa,iBACzDyB,eAAeK,QAAQhD,KAAKyC,cAAeI,KAAKI,UAAUrC,QAjIrDsC,OAAS,CACdC,SAAUC,UAELC,QAAU,CACf,CAAC,UAAW,iBACZ,CAAC,UAAW,6BACZ,CAAC,UAAW"}